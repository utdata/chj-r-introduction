---
title: "R Notebook"
output: html_notebook
---

## Setup

```{r setup}
library(tidyverse)
library(readxl)
library(janitor)
library(lubridate)
```

## Day 1

### Download the file

Use `download.file` to get the data

```{r download}
download.file("https://github.com/utdata/chj-r-introduction/blob/main/students/chj-practice/data-raw/maritime-redacted.xlsx?raw=true", "data-raw/maritime.xlsx")
```

### Import the file

```{r}
reports <- read_excel("data-raw/maritime-redacted.xlsx") %>% clean_names()

reports %>% head()
```

### glimpse

```{r}
reports %>% glimpse()
```
### How many reports are there?

```{r}
reports %>% nrow()
# can also get from the glimpse()
```

### What is the date range of the data

```{r}
reports$report_date %>% 
  summary()
```
Answer: Jan 1, 2020 to May 30, 2020.

### Export the file

```{r export}
reports %>% write_rds("data-processed/reports.rds")
```


## Day 2, Part 1

Even though we exported the data, we'll continue here with `reports`.


### Cut the data

```{r}
reports_cut <- reports %>% 
  select(report_date, death_illness, q_station, notification_time, agency, person_type, gender, vessel_name, presumptive_diagnosis)

reports_cut %>% glimpse()
```

### Percentage of reports as crew

Get number of total reports

```{r}
total_reports = reports_cut %>% nrow()

total_reports
```

Get number of crew reports

```{r}
crew <- reports_cut %>% 
  filter(person_type == "Crew Member")

crew_numb = crew %>% nrow()

crew_numb
```

Percentage that is crew

```{r}
((crew_numb / total_reports) * 100) %>% round(1)
```

## Day 2, Part 2

### Where were the most people held in quarantined

```{r}
reports_cut %>% 
  count(q_station, sort = TRUE, name = "people_quarantined")
```


### Which vessel had the most Coronavirus cases

```{r}
reports_cut %>% 
  filter(str_detect(presumptive_diagnosis, "2019 Novel Coronavirus")) %>% 
  group_by(vessel_name) %>% 
  summarise(cnt = n()) %>% 
  arrange(cnt %>% desc())
```

### How many people died?

Col is death_illness

```{r}
reports_cut %>% 
  count(death_illness, name = "cnt")
```


### Cases per month

```{r}
reports_cut %>% 
  filter(str_detect(presumptive_diagnosis, "2019 Novel Coronavirus")) %>% 
  group_by(mo = month(report_date, label = T)) %>% 
  summarise(cnt = n())
```

