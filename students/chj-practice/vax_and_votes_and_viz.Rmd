---
title: "Vaccinations and votes and visualizations"
output: html_document
---

## Practice quests - Day 4

### Go to your chj-practice project

1. Open up chj-practice.proj
2. Load the tidyverse package

```{r setup}
library(tidyverse)
```

### import the vax.RDS file that you imported and saved to your "data-raw" folder yesterday 
### use the function `saveRDS()`

```{r loading}
vax <- readRDS("data-raw/vax.RDS")
```

## Load the library that works with dates

```{r lubridate}
library(lubridate)
```

## 1. Filter it to the latest week of data
### Name it vax_recent

```{r }
vax_recent <- vax %>% 
  mutate(Date=mdy(Date)) %>% 
  group_by(FIPS) %>% 
  arrange(desc(Date)) %>% 
  slice(1)
```

## 2. Create a bar plot of the five counties with the highest vaccination rates
### Series_Complete_Pop_Pct

```{r q2}
vax_recent %>% 
  ungroup() %>% 
  arrange(desc(Series_Complete_Pop_Pct)) %>% 
  slice(1:5) %>% 
  ggplot(aes(x=Recip_County, y=Series_Complete_Pop_Pct)) +
  geom_bar(stat="identity")
```

## 3. Style the bar plot you created with a chart title, a caption ("Data: CDC"), and y and x axis labels

```{r q3}
vax_recent %>% 
  ungroup() %>% 
  arrange(desc(Series_Complete_Pop_Pct)) %>% 
  slice(1:5) %>% 
  ggplot(aes(x=Recip_County, y=Series_Complete_Pop_Pct)) +
  geom_bar(stat="identity") %>% 
  labs(title="Top five counties with highest vaccination rates",
       caption="Data: CDC",
       y="Vaccination rate",
       x="")
```

## 4. Create a bar plot of the five counties that saw the biggest jumps in vaccination rates between June 1 and October 1

```{r q4}
vax %>% 
  mutate(Date=mdy(Date)) %>% 
  filter(Date==mdy("06/01/21") | Date==mdy("10/01/21")) %>% 
  select(Recip_County, Recip_State, Date, Series_Complete_Pop_Pct) %>% 
  pivot_wider(names_from="Date", values_from="Series_Complete_Pop_Pct") %>% 
  mutate(change=`2021-10-01`-`2021-06-01`) %>% 
  arrange(desc(change)) %>% 
  slice(1:5) %>% 
  ggplot(aes(x=Recip_County, y=change)) +
    geom_bar(stat="identity") +
    labs(title="Five counties with the biggest change in vaccination rates",
         subtitle="Between June and October",
         y="Vax rate change",
         x="County")
```

## Import in this presidential election results data by county
### save it to the object "election"

```{r import2}
election <- read_csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vTRNr9AxpysIFXKHymcCynzdWAJUePkCi3M6E0z5shAPVv1MCQQA2DnLkgUjaQzrq6m0I2mWw80SYvC/pub?gid=456911902&single=true&output=csv")
```

## 5. Prep the election dataframe to join like you did yesterday
### add a zero in front of the fips code if the number of characters is 4

```{r election_fips}
election <- election %>% 
  mutate(
    fips=as.character(fips),
    FIPS=case_when(
    nchar(fips)==4 ~ paste0("0", fips),
    TRUE ~ fips
  ))
```

## 6. join election to vax_recent
### call the dataframe vax_election

```{r vax_election}
vax_election <- left_join(vax_recent, election)
```

## 7. Create a scatterplot of county vaccination rates to percent of Trump votes

```{r scatter1}
ggplot(vax_election, aes(x=Series_Complete_Pop_Pct, y=biden_pct)) +
  geom_point()
```

# 8. Create a scatterplot of county vaccination rates to percent of Trump votes and color the points based on who won in that county

```{r scatter2}
ggplot(vax_election, aes(x=Series_Complete_Pop_Pct, y=biden_pct, color=winner)) +
  geom_point()
```
